<div class="finder">
  <h1><%= @article.name %> <a class="save" href="/wiki/<%= URI.escape @article.name %>">Save</a></h1>
  <nav class="in">
    <h2>Links In</h2>
    <ul>
      <% @article.inlinks.each do |title| %>
        <li>
          <a href="/wiki/<%= URI.escape title %>"><%= title %></a>
          <!--
          <ul>
            <li><a href="#">Influenced</a></li>
            <li><a href="#">Influenced By</a></li>
          </ul>
          -->
        </li>
      <% end %>
    </ul>
  </nav>
  <nav class="out">
    <h2>Links Out</h2>
    <ul>
      <% @article.outlinks.each do |title| %>
        <li>
          <a href="/wiki/<%= URI.escape title %>"><%= title %></a>
          <!--
          <ul>
            <li><a href="#">Influenced</a></li>
            <li><a href="#">Influenced By</a></li>
          </ul>
          -->
        </li>
      <% end %>
    </ul>
  </nav>
</div>


<hr class="hide">

<section class="article-text">
  <%= @article.html %>
</section>

<script type="text/javascript">
  var storage = new Weaver.Storage();

  var findSaved = function () {
    storage.getSavedArticles(function(articles) {
      var names = articles.map(function(a) { return a.name });

      $('a.save').each(function(i, link) {
        var href = $(link).attr('href');

        var slug = href.replace(/^.*\/wiki\/(.*)$/, '$1'),
            name = decodeURIComponent(slug);

        if (names.indexOf(name) < 0) return;

        $(link).addClass('saved').html('Saved!');
      });
    });
  };

  // Do it once at startup.
  findSaved();

  // Do it once we've saved the article.
  $('a.save').live('click', function() {
    var slug = $(this).attr('href').replace(/^.*\/wiki\/(.*)$/, '$1'),
        name = decodeURIComponent(slug);
        article = new Weaver.Article(name);

    article.save();

    findSaved();

    return false;
  });


</script>

